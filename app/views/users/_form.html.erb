<!-- app/views/users/_form.html.erb -->

<%= form_with(model: @user, local: true, class: 'needs-validation', novalidate: true) do |form| %>
  <div class="mb-3">
    <%= form.label :name, class: 'form-label' %>
    <%= form.text_field :name, class: 'form-control', required: true %>
    <div class="invalid-feedback">
      Please provide a valid name.
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :email, class: 'form-label' %>
    <%= form.email_field :email, class: 'form-control', required: true %>
    <div class="invalid-feedback">
      Please provide a valid email.
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :password, class: 'form-label' %>
    <%= form.password_field :password, class: 'form-control' %>
    <div class="invalid-feedback">
      Please provide a valid password.
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :password_confirmation, class: 'form-label' %>
    <%= form.password_field :password_confirmation, class: 'form-control' %>
    <div class="invalid-feedback">
      Please confirm your password.
    </div>
  </div>

  <div class="d-grid">
    <%= form.submit (params[:action] == 'new' ? 'Sign Up' : 'Update Profile'), class: 'btn btn-primary' %>
  </div>
<% end %>

<script>
  // JavaScript for disabling form submissions if there are invalid fields
  (function () {
    'use strict';
    window.addEventListener('load', function () {
      var forms = document.getElementsByClassName('needs-validation');
      var validation = Array.prototype.filter.call(forms, function (form) {
        form.addEventListener('submit', function (event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
</script>
